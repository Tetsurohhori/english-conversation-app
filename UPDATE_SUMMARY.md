# 更新サマリー（簡易版）

## 📋 5つの主要機能を追加

### 1. 英語レベル選択機能 ✅
- **変更ファイル**: constants.py, main.py
- **内容**: 初級・中級・上級に応じてプロンプトを動的に変更
- **キーワード**: 辞書型, 動的プロンプト選択

### 2. スコアリング機能 ✅
- **変更ファイル**: constants.py, functions.py, main.py
- **内容**: 0-100点のスコア表示、バッジ表示
- **キーワード**: 正規表現, 条件分岐, f-string

### 3. 学習履歴管理 ✅
- **変更ファイル**: main.py
- **内容**: サイドバーに統計表示、グラフ化
- **キーワード**: Pandas, リスト内包表記, セッション状態

### 4. エラーハンドリング ✅
- **変更ファイル**: functions.py, main.py
- **内容**: API エラー、ネットワークエラーの適切な処理
- **キーワード**: try-except, 例外処理, リソース管理

### 5. トピック・シチュエーション選択 ✅
- **変更ファイル**: constants.py, functions.py, main.py
- **内容**: 7種類のトピック、10種類のシチュエーション
- **キーワード**: 辞書, 文字列連結, 動的プロンプト生成

---

## 📊 変更統計

| ファイル | 変更前の行数 | 変更後の行数 | 追加 | 削除 |
|---------|------------|------------|-----|-----|
| constants.py | 55 | 123 | +68 | -5 |
| functions.py | 176 | 286 | +110 | -19 |
| main.py | 287 | 474 | +187 | -49 |
| **合計** | 518 | 883 | **+365** | **-73** |

---

## 🔑 重要な新規追加関数

### functions.py
1. `create_problem_prompt_with_context()` - プロンプト生成
2. `extract_score()` - スコア抽出
3. `display_score_badge()` - バッジ表示

### エラーハンドリング追加
- `transcribe_audio()` - 音声認識のエラー処理
- `create_problem_and_play_audio()` - 問題生成のエラー処理
- `create_evaluation()` - 評価生成のエラー処理

---

## 📂 新規追加データ構造

### constants.py
```python
TOPIC_OPTIONS = {辞書: 7種類}
SITUATION_OPTIONS = {辞書: 10種類}
SYSTEM_TEMPLATE_BASIC_CONVERSATION = {辞書: 3レベル}
SYSTEM_TEMPLATE_CREATE_PROBLEM = {辞書: 3レベル}
```

### main.py (セッション状態)
```python
st.session_state.score_history = [
    {'mode': str, 'score': int, 'timestamp': float},
    ...
]
st.session_state.topic = str
st.session_state.situation = str
st.session_state.current_level = str
```

---

## 🎨 UI 変更

### 追加されたUI要素
1. **トピック選択ボックス** (シャドーイング・ディクテーションのみ)
2. **シチュエーション選択ボックス** (シャドーイング・ディクテーションのみ)
3. **サイドバーの学習統計**
   - 総学習回数
   - 平均スコア
   - 最高スコア
   - 最新スコア
   - スコア推移グラフ
   - モード別統計
   - リセットボタン
4. **スコアバッジ** (評価結果の上に表示)

---

## 🧪 テスト方法

### 1. 英語レベル選択
```
1. 初級者を選択 → 簡単な問題が出題されるか
2. 上級者を選択 → 難しい問題が出題されるか
```

### 2. スコア機能
```
1. ディクテーションで回答 → スコアバッジが表示されるか
2. サイドバーに統計が表示されるか
3. グラフが更新されるか
```

### 3. エラーハンドリング
```
1. ネットワークをオフにして実行 → エラーメッセージが表示されるか
2. 不正なAPIキーで実行 → 適切なエラーが表示されるか
```

### 4. トピック選択
```
1. 「ビジネス」選択 → ビジネス関連の問題が出るか
2. 「レストラン」選択 → レストランのシチュエーションか
```

### 5. 学習履歴
```
1. 複数回練習 → 履歴が蓄積されるか
2. リセットボタン → 履歴がクリアされるか
```

---

## 📝 学習のポイント

### 初心者向け
- [ ] 辞書型の基本（キーと値）
- [ ] if文の条件分岐
- [ ] for文のループ処理
- [ ] 関数の定義と呼び出し

### 中級者向け
- [ ] リスト内包表記
- [ ] try-except例外処理
- [ ] 正規表現の基本
- [ ] Streamlitのセッション状態

### 上級者向け
- [ ] 動的なプロンプト生成
- [ ] データフローの設計
- [ ] エラーハンドリングのベストプラクティス
- [ ] コードの再利用性

---

## 🔗 関連ドキュメント

詳細な解説は `CHANGES.md` を参照してください。

- **CHANGES.md**: 詳細な実装解説（学習用）
- **requirements.txt**: 依存パッケージ
- **.gitignore**: Git除外ファイル

---

## 📞 サポート

質問や不明点があれば、以下を確認してください：
1. CHANGES.md の詳細解説
2. コード内のコメント
3. Git の差分（`git diff ffff204 b029b5f`）

---

最終更新: 2025年12月17日
コミットID: b029b5f



